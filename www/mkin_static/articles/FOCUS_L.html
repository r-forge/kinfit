<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example evaluation of FOCUS Laboratory Data L1 to L3 • mkin</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Example evaluation of FOCUS Laboratory Data L1 to L3">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">mkin</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Functions and data</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mkin.html">Introduction to mkin</a>
    </li>
    <li>
      <a href="../articles/FOCUS_D.html">Example evaluation of FOCUS Example Dataset D</a>
    </li>
    <li>
      <a href="../articles/FOCUS_L.html">Example evaluation of FOCUS Laboratory Data L1 to L3</a>
    </li>
    <li>
      <a href="../articles/FOCUS_Z.html">Example evaluation of FOCUS Example Dataset Z</a>
    </li>
    <li>
      <a href="../articles/compiled_models.html">Performance benefit by using compiled model definitions in mkin</a>
    </li>
    <li>
      <a href="../articles/twa.html">Calculation of time weighted average concentrations with mkin</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Example evaluation of FOCUS Laboratory Data L1 to L3</h1>
                        <h4 class="author">Johannes Ranke</h4>
            
            <h4 class="date">2018-03-01</h4>
          </div>

    
    
<div class="contents">
<div id="laboratory-data-l1" class="section level1">
<h1 class="hasAnchor">
<a href="#laboratory-data-l1" class="anchor"></a>Laboratory Data L1</h1>
<p>The following code defines example dataset L1 from the FOCUS kinetics report, p. 284:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"mkin"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)
FOCUS_<span class="dv">2006</span>_L1 =<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">t =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">14</span>, <span class="dv">21</span>, <span class="dv">30</span>), <span class="dt">each =</span> <span class="dv">2</span>),
  <span class="dt">parent =</span> <span class="kw">c</span>(<span class="fl">88.3</span>, <span class="fl">91.4</span>, <span class="fl">85.6</span>, <span class="fl">84.5</span>, <span class="fl">78.9</span>, <span class="fl">77.6</span>,
             <span class="fl">72.0</span>, <span class="fl">71.9</span>, <span class="fl">50.3</span>, <span class="fl">59.4</span>, <span class="fl">47.0</span>, <span class="fl">45.1</span>,
             <span class="fl">27.7</span>, <span class="fl">27.3</span>, <span class="fl">10.0</span>, <span class="fl">10.4</span>, <span class="fl">2.9</span>, <span class="fl">4.0</span>))
FOCUS_<span class="dv">2006</span>_L1_mkin &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mkin_wide_to_long.html">mkin_wide_to_long</a></span>(FOCUS_<span class="dv">2006</span>_L1)</code></pre></div>
<p>Here we use the assumptions of simple first order (SFO), the case of declining rate constant over time (FOMC) and the case of two different phases of the kinetics (DFOP). For a more detailed discussion of the models, please see the FOCUS kinetics report.</p>
<p>Since mkin version 0.9-32 (July 2014), we can use shorthand notation like <code>"SFO"</code> for parent only degradation models. The following two lines fit the model and produce the summary report of the model fit. This covers the numerical analysis given in the FOCUS report.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m.L1.SFO &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mkinfit.html">mkinfit</a></span>(<span class="st">"SFO"</span>, FOCUS_<span class="dv">2006</span>_L1_mkin, <span class="dt">quiet =</span> <span class="ot">TRUE</span>)
<span class="kw">summary</span>(m.L1.SFO)</code></pre></div>
<pre><code>## mkin version:    0.9.46.3 
## R version:       3.4.3 
## Date of fit:     Thu Mar  1 14:31:57 2018 
## Date of summary: Thu Mar  1 14:31:57 2018 
## 
## Equations:
## d_parent/dt = - k_parent_sink * parent
## 
## Model predictions using solution type analytical 
## 
## Fitted with method Port using 37 model solutions performed in 0.24 s
## 
## Weighting: none
## 
## Starting values for parameters to be optimised:
##               value   type
## parent_0      89.85  state
## k_parent_sink  0.10 deparm
## 
## Starting values for the transformed parameters actually optimised:
##                       value lower upper
## parent_0          89.850000  -Inf   Inf
## log_k_parent_sink -2.302585  -Inf   Inf
## 
## Fixed parameter values:
## None
## 
## Optimised, transformed parameters with symmetric confidence intervals:
##                   Estimate Std. Error  Lower  Upper
## parent_0            92.470    1.36800 89.570 95.370
## log_k_parent_sink   -2.347    0.04057 -2.433 -2.261
## 
## Parameter correlation:
##                   parent_0 log_k_parent_sink
## parent_0            1.0000            0.6248
## log_k_parent_sink   0.6248            1.0000
## 
## Residual standard error: 2.948 on 16 degrees of freedom
## 
## Backtransformed parameters:
## Confidence intervals for internally transformed parameters are asymmetric.
## t-test (unrealistically) based on the assumption of normal distribution
## for estimators of untransformed parameters.
##               Estimate t value    Pr(&gt;t)    Lower   Upper
## parent_0      92.47000   67.58 2.170e-21 89.57000 95.3700
## k_parent_sink  0.09561   24.65 1.867e-14  0.08773  0.1042
## 
## Chi2 error levels in percent:
##          err.min n.optim df
## All data   3.424       2  7
## parent     3.424       2  7
## 
## Resulting formation fractions:
##             ff
## parent_sink  1
## 
## Estimated disappearance times:
##         DT50  DT90
## parent 7.249 24.08
## 
## Data:
##  time variable observed predicted residual
##     0   parent     88.3    92.471  -4.1710
##     0   parent     91.4    92.471  -1.0710
##     1   parent     85.6    84.039   1.5610
##     1   parent     84.5    84.039   0.4610
##     2   parent     78.9    76.376   2.5241
##     2   parent     77.6    76.376   1.2241
##     3   parent     72.0    69.412   2.5884
##     3   parent     71.9    69.412   2.4884
##     5   parent     50.3    57.330  -7.0301
##     5   parent     59.4    57.330   2.0699
##     7   parent     47.0    47.352  -0.3515
##     7   parent     45.1    47.352  -2.2515
##    14   parent     27.7    24.247   3.4528
##    14   parent     27.3    24.247   3.0528
##    21   parent     10.0    12.416  -2.4163
##    21   parent     10.4    12.416  -2.0163
##    30   parent      2.9     5.251  -2.3513
##    30   parent      4.0     5.251  -1.2513</code></pre>
<p>A plot of the fit is obtained with the plot function for mkinfit objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(m.L1.SFO, <span class="dt">show_errmin =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"FOCUS L1 - SFO"</span>)</code></pre></div>
<p><img src="FOCUS_L_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<p>The residual plot can be easily obtained by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/mkinresplot.html">mkinresplot</a></span>(m.L1.SFO, <span class="dt">ylab =</span> <span class="st">"Observed"</span>, <span class="dt">xlab =</span> <span class="st">"Time"</span>)</code></pre></div>
<p><img src="FOCUS_L_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<p>For comparison, the FOMC model is fitted as well, and the <span class="math inline">\(\chi^2\)</span> error level is checked.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m.L1.FOMC &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mkinfit.html">mkinfit</a></span>(<span class="st">"FOMC"</span>, FOCUS_<span class="dv">2006</span>_L1_mkin, <span class="dt">quiet=</span><span class="ot">TRUE</span>)
<span class="kw">plot</span>(m.L1.FOMC, <span class="dt">show_errmin =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"FOCUS L1 - FOMC"</span>)</code></pre></div>
<p><img src="FOCUS_L_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(m.L1.FOMC, <span class="dt">data =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## mkin version:    0.9.46.3 
## R version:       3.4.3 
## Date of fit:     Thu Mar  1 14:31:59 2018 
## Date of summary: Thu Mar  1 14:32:00 2018 
## 
## Equations:
## d_parent/dt = - (alpha/beta) * 1/((time/beta) + 1) * parent
## 
## Model predictions using solution type analytical 
## 
## Fitted with method Port using 611 model solutions performed in 1.375 s
## 
## Weighting: none
## 
## Starting values for parameters to be optimised:
##          value   type
## parent_0 89.85  state
## alpha     1.00 deparm
## beta     10.00 deparm
## 
## Starting values for the transformed parameters actually optimised:
##               value lower upper
## parent_0  89.850000  -Inf   Inf
## log_alpha  0.000000  -Inf   Inf
## log_beta   2.302585  -Inf   Inf
## 
## Fixed parameter values:
## None
## 
## Optimised, transformed parameters with symmetric confidence intervals:
##           Estimate Std. Error    Lower   Upper
## parent_0     92.47      1.482    89.31   95.63
## log_alpha    11.25    598.200 -1264.00 1286.00
## log_beta     13.60    598.200 -1261.00 1289.00
## 
## Parameter correlation:
##           parent_0 log_alpha log_beta
## parent_0    1.0000   -0.3016  -0.3016
## log_alpha  -0.3016    1.0000   1.0000
## log_beta   -0.3016    1.0000   1.0000
## 
## Residual standard error: 3.045 on 15 degrees of freedom
## 
## Backtransformed parameters:
## Confidence intervals for internally transformed parameters are asymmetric.
## t-test (unrealistically) based on the assumption of normal distribution
## for estimators of untransformed parameters.
##           Estimate  t value    Pr(&gt;t) Lower Upper
## parent_0     92.47 64.45000 4.757e-20 89.31 95.63
## alpha     76830.00  0.02852 4.888e-01  0.00   Inf
## beta     803500.00  0.02852 4.888e-01  0.00   Inf
## 
## Chi2 error levels in percent:
##          err.min n.optim df
## All data   3.619       3  6
## parent     3.619       3  6
## 
## Estimated disappearance times:
##         DT50  DT90 DT50back
## parent 7.249 24.08    7.249</code></pre>
<p>We get a warning that the default optimisation algorithm <code>Port</code> did not converge, which is an indication that the model is overparameterised, <em>i.e.</em> contains too many parameters that are ill-defined as a consequence.</p>
<p>And in fact, due to the higher number of parameters, and the lower number of degrees of freedom of the fit, the <span class="math inline">\(\chi^2\)</span> error level is actually higher for the FOMC model (3.6%) than for the SFO model (3.4%). Additionally, the parameters <code>log_alpha</code> and <code>log_beta</code> internally fitted in the model have excessive confidence intervals, that span more than 25 orders of magnitude (!) when backtransformed to the scale of <code>alpha</code> and <code>beta</code>. Also, the t-test for significant difference from zero does not indicate such a significant difference, with p-values greater than 0.1, and finally, the parameter correlation of <code>log_alpha</code> and <code>log_beta</code> is 1.000, clearly indicating that the model is overparameterised.</p>
<p>The <span class="math inline">\(\chi^2\)</span> error levels reported in Appendix 3 and Appendix 7 to the FOCUS kinetics report are rounded to integer percentages and partly deviate by one percentage point from the results calculated by mkin. The reason for this is not known. However, mkin gives the same <span class="math inline">\(\chi^2\)</span> error levels as the kinfit package and the calculation routines of the kinfit package have been extensively compared to the results obtained by the KinGUI software, as documented in the kinfit package vignette. KinGUI was the first widely used standard package in this field. Also, the calculation of <span class="math inline">\(\chi^2\)</span> error levels was compared with KinGUII, CAKE and DegKin manager in a project sponsored by the German Umweltbundesamt <span class="citation">(Ranke 2014)</span>.</p>
</div>
<div id="laboratory-data-l2" class="section level1">
<h1 class="hasAnchor">
<a href="#laboratory-data-l2" class="anchor"></a>Laboratory Data L2</h1>
<p>The following code defines example dataset L2 from the FOCUS kinetics report, p. 287:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FOCUS_<span class="dv">2006</span>_L2 =<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">t =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">14</span>, <span class="dv">28</span>), <span class="dt">each =</span> <span class="dv">2</span>),
  <span class="dt">parent =</span> <span class="kw">c</span>(<span class="fl">96.1</span>, <span class="fl">91.8</span>, <span class="fl">41.4</span>, <span class="fl">38.7</span>,
             <span class="fl">19.3</span>, <span class="fl">22.3</span>, <span class="fl">4.6</span>, <span class="fl">4.6</span>,
             <span class="fl">2.6</span>, <span class="fl">1.2</span>, <span class="fl">0.3</span>, <span class="fl">0.6</span>))
FOCUS_<span class="dv">2006</span>_L2_mkin &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mkin_wide_to_long.html">mkin_wide_to_long</a></span>(FOCUS_<span class="dv">2006</span>_L2)</code></pre></div>
<div id="sfo-fit-for-l2" class="section level2">
<h2 class="hasAnchor">
<a href="#sfo-fit-for-l2" class="anchor"></a>SFO fit for L2</h2>
<p>Again, the SFO model is fitted and the result is plotted. The residual plot can be obtained simply by adding the argument <code>show_residuals</code> to the plot command.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m.L2.SFO &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mkinfit.html">mkinfit</a></span>(<span class="st">"SFO"</span>, FOCUS_<span class="dv">2006</span>_L2_mkin, <span class="dt">quiet=</span><span class="ot">TRUE</span>)
<span class="kw">plot</span>(m.L2.SFO, <span class="dt">show_residuals =</span> <span class="ot">TRUE</span>, <span class="dt">show_errmin =</span> <span class="ot">TRUE</span>,
     <span class="dt">main =</span> <span class="st">"FOCUS L2 - SFO"</span>)</code></pre></div>
<p><img src="FOCUS_L_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>The <span class="math inline">\(\chi^2\)</span> error level of 14% suggests that the model does not fit very well. This is also obvious from the plots of the fit, in which we have included the residual plot.</p>
<p>In the FOCUS kinetics report, it is stated that there is no apparent systematic error observed from the residual plot up to the measured DT90 (approximately at day 5), and there is an underestimation beyond that point.</p>
<p>We may add that it is difficult to judge the random nature of the residuals just from the three samplings at days 0, 1 and 3. Also, it is not clear <em>a priori</em> why a consistent underestimation after the approximate DT90 should be irrelevant. However, this can be rationalised by the fact that the FOCUS fate models generally only implement SFO kinetics.</p>
</div>
<div id="fomc-fit-for-l2" class="section level2">
<h2 class="hasAnchor">
<a href="#fomc-fit-for-l2" class="anchor"></a>FOMC fit for L2</h2>
<p>For comparison, the FOMC model is fitted as well, and the <span class="math inline">\(\chi^2\)</span> error level is checked.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m.L2.FOMC &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mkinfit.html">mkinfit</a></span>(<span class="st">"FOMC"</span>, FOCUS_<span class="dv">2006</span>_L2_mkin, <span class="dt">quiet =</span> <span class="ot">TRUE</span>)
<span class="kw">plot</span>(m.L2.FOMC, <span class="dt">show_residuals =</span> <span class="ot">TRUE</span>,
     <span class="dt">main =</span> <span class="st">"FOCUS L2 - FOMC"</span>)</code></pre></div>
<p><img src="FOCUS_L_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(m.L2.FOMC, <span class="dt">data =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## mkin version:    0.9.46.3 
## R version:       3.4.3 
## Date of fit:     Thu Mar  1 14:32:00 2018 
## Date of summary: Thu Mar  1 14:32:00 2018 
## 
## Equations:
## d_parent/dt = - (alpha/beta) * 1/((time/beta) + 1) * parent
## 
## Model predictions using solution type analytical 
## 
## Fitted with method Port using 81 model solutions performed in 0.158 s
## 
## Weighting: none
## 
## Starting values for parameters to be optimised:
##          value   type
## parent_0 93.95  state
## alpha     1.00 deparm
## beta     10.00 deparm
## 
## Starting values for the transformed parameters actually optimised:
##               value lower upper
## parent_0  93.950000  -Inf   Inf
## log_alpha  0.000000  -Inf   Inf
## log_beta   2.302585  -Inf   Inf
## 
## Fixed parameter values:
## None
## 
## Optimised, transformed parameters with symmetric confidence intervals:
##           Estimate Std. Error   Lower   Upper
## parent_0   93.7700     1.8560 89.5700 97.9700
## log_alpha   0.3180     0.1867 -0.1044  0.7405
## log_beta    0.2102     0.2943 -0.4555  0.8759
## 
## Parameter correlation:
##           parent_0 log_alpha log_beta
## parent_0   1.00000  -0.09553  -0.1863
## log_alpha -0.09553   1.00000   0.9757
## log_beta  -0.18628   0.97567   1.0000
## 
## Residual standard error: 2.628 on 9 degrees of freedom
## 
## Backtransformed parameters:
## Confidence intervals for internally transformed parameters are asymmetric.
## t-test (unrealistically) based on the assumption of normal distribution
## for estimators of untransformed parameters.
##          Estimate t value    Pr(&gt;t)   Lower  Upper
## parent_0   93.770  50.510 1.173e-12 89.5700 97.970
## alpha       1.374   5.355 2.296e-04  0.9009  2.097
## beta        1.234   3.398 3.949e-03  0.6341  2.401
## 
## Chi2 error levels in percent:
##          err.min n.optim df
## All data   6.205       3  3
## parent     6.205       3  3
## 
## Estimated disappearance times:
##          DT50  DT90 DT50back
## parent 0.8092 5.356    1.612</code></pre>
<p>The error level at which the <span class="math inline">\(\chi^2\)</span> test passes is much lower in this case. Therefore, the FOMC model provides a better description of the data, as less experimental error has to be assumed in order to explain the data.</p>
</div>
<div id="dfop-fit-for-l2" class="section level2">
<h2 class="hasAnchor">
<a href="#dfop-fit-for-l2" class="anchor"></a>DFOP fit for L2</h2>
<p>Fitting the four parameter DFOP model further reduces the <span class="math inline">\(\chi^2\)</span> error level.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m.L2.DFOP &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mkinfit.html">mkinfit</a></span>(<span class="st">"DFOP"</span>, FOCUS_<span class="dv">2006</span>_L2_mkin, <span class="dt">quiet =</span> <span class="ot">TRUE</span>)
<span class="kw">plot</span>(m.L2.DFOP, <span class="dt">show_residuals =</span> <span class="ot">TRUE</span>, <span class="dt">show_errmin =</span> <span class="ot">TRUE</span>,
     <span class="dt">main =</span> <span class="st">"FOCUS L2 - DFOP"</span>)</code></pre></div>
<p><img src="FOCUS_L_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(m.L2.DFOP, <span class="dt">data =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## mkin version:    0.9.46.3 
## R version:       3.4.3 
## Date of fit:     Thu Mar  1 14:32:01 2018 
## Date of summary: Thu Mar  1 14:32:01 2018 
## 
## Equations:
## d_parent/dt = - ((k1 * g * exp(-k1 * time) + k2 * (1 - g) *
##            exp(-k2 * time)) / (g * exp(-k1 * time) + (1 - g) *
##            exp(-k2 * time))) * parent
## 
## Model predictions using solution type analytical 
## 
## Fitted with method Port using 336 model solutions performed in 0.708 s
## 
## Weighting: none
## 
## Starting values for parameters to be optimised:
##          value   type
## parent_0 93.95  state
## k1        0.10 deparm
## k2        0.01 deparm
## g         0.50 deparm
## 
## Starting values for the transformed parameters actually optimised:
##              value lower upper
## parent_0 93.950000  -Inf   Inf
## log_k1   -2.302585  -Inf   Inf
## log_k2   -4.605170  -Inf   Inf
## g_ilr     0.000000  -Inf   Inf
## 
## Fixed parameter values:
## None
## 
## Optimised, transformed parameters with symmetric confidence intervals:
##          Estimate Std. Error Lower Upper
## parent_0  93.9500         NA    NA    NA
## log_k1     3.1370         NA    NA    NA
## log_k2    -1.0880         NA    NA    NA
## g_ilr     -0.2821         NA    NA    NA
## 
## Parameter correlation:</code></pre>
<pre><code>## Warning in print.summary.mkinfit(x): Could not estimate covariance matrix; singular system:</code></pre>
<pre><code>## Could not estimate covariance matrix; singular system:
## 
## Residual standard error: 1.732 on 8 degrees of freedom
## 
## Backtransformed parameters:
## Confidence intervals for internally transformed parameters are asymmetric.
## t-test (unrealistically) based on the assumption of normal distribution
## for estimators of untransformed parameters.
##          Estimate t value Pr(&gt;t) Lower Upper
## parent_0  93.9500      NA     NA    NA    NA
## k1        23.0400      NA     NA    NA    NA
## k2         0.3369      NA     NA    NA    NA
## g          0.4016      NA     NA    NA    NA
## 
## Chi2 error levels in percent:
##          err.min n.optim df
## All data    2.53       4  2
## parent      2.53       4  2
## 
## Estimated disappearance times:
##          DT50  DT90 DT50_k1 DT50_k2
## parent 0.5335 5.311 0.03009   2.058</code></pre>
<p>Here, the DFOP model is clearly the best-fit model for dataset L2 based on the chi^2 error level criterion. However, the failure to calculate the covariance matrix indicates that the parameter estimates correlate excessively. Therefore, the FOMC model may be preferred for this dataset.</p>
</div>
</div>
<div id="laboratory-data-l3" class="section level1">
<h1 class="hasAnchor">
<a href="#laboratory-data-l3" class="anchor"></a>Laboratory Data L3</h1>
<p>The following code defines example dataset L3 from the FOCUS kinetics report, p. 290.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FOCUS_<span class="dv">2006</span>_L3 =<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">t =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">14</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">91</span>, <span class="dv">120</span>),
  <span class="dt">parent =</span> <span class="kw">c</span>(<span class="fl">97.8</span>, <span class="dv">60</span>, <span class="dv">51</span>, <span class="dv">43</span>, <span class="dv">35</span>, <span class="dv">22</span>, <span class="dv">15</span>, <span class="dv">12</span>))
FOCUS_<span class="dv">2006</span>_L3_mkin &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mkin_wide_to_long.html">mkin_wide_to_long</a></span>(FOCUS_<span class="dv">2006</span>_L3)</code></pre></div>
<div id="fit-multiple-models" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-multiple-models" class="anchor"></a>Fit multiple models</h2>
<p>As of mkin version 0.9-39 (June 2015), we can fit several models to one or more datasets in one call to the function <code>mmkin</code>. The datasets have to be passed in a list, in this case a named list holding only the L3 dataset prepared above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Only use one core here, not to offend the CRAN checks</span>
mm.L3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mmkin.html">mmkin</a></span>(<span class="kw">c</span>(<span class="st">"SFO"</span>, <span class="st">"FOMC"</span>, <span class="st">"DFOP"</span>), <span class="dt">cores =</span> <span class="dv">1</span>,
               <span class="kw">list</span>(<span class="st">"FOCUS L3"</span> =<span class="st"> </span>FOCUS_<span class="dv">2006</span>_L3_mkin), <span class="dt">quiet =</span> <span class="ot">TRUE</span>)
<span class="kw">plot</span>(mm.L3)</code></pre></div>
<p><img src="FOCUS_L_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>The <span class="math inline">\(\chi^2\)</span> error level of 21% as well as the plot suggest that the SFO model does not fit very well. The FOMC model performs better, with an error level at which the <span class="math inline">\(\chi^2\)</span> test passes of 7%. Fitting the four parameter DFOP model further reduces the <span class="math inline">\(\chi^2\)</span> error level considerably.</p>
</div>
<div id="accessing-mmkin-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#accessing-mmkin-objects" class="anchor"></a>Accessing mmkin objects</h2>
<p>The objects returned by mmkin are arranged like a matrix, with models as a row index and datasets as a column index.</p>
<p>We can extract the summary and plot for <em>e.g.</em> the DFOP fit, using square brackets for indexing which will result in the use of the summary and plot functions working on mkinfit objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(mm.L3[[<span class="st">"DFOP"</span>, <span class="dv">1</span>]])</code></pre></div>
<pre><code>## mkin version:    0.9.46.3 
## R version:       3.4.3 
## Date of fit:     Thu Mar  1 14:32:02 2018 
## Date of summary: Thu Mar  1 14:32:02 2018 
## 
## Equations:
## d_parent/dt = - ((k1 * g * exp(-k1 * time) + k2 * (1 - g) *
##            exp(-k2 * time)) / (g * exp(-k1 * time) + (1 - g) *
##            exp(-k2 * time))) * parent
## 
## Model predictions using solution type analytical 
## 
## Fitted with method Port using 137 model solutions performed in 0.287 s
## 
## Weighting: none
## 
## Starting values for parameters to be optimised:
##          value   type
## parent_0 97.80  state
## k1        0.10 deparm
## k2        0.01 deparm
## g         0.50 deparm
## 
## Starting values for the transformed parameters actually optimised:
##              value lower upper
## parent_0 97.800000  -Inf   Inf
## log_k1   -2.302585  -Inf   Inf
## log_k2   -4.605170  -Inf   Inf
## g_ilr     0.000000  -Inf   Inf
## 
## Fixed parameter values:
## None
## 
## Optimised, transformed parameters with symmetric confidence intervals:
##          Estimate Std. Error   Lower     Upper
## parent_0  97.7500    1.43800 93.7500 101.70000
## log_k1    -0.6612    0.13340 -1.0310  -0.29100
## log_k2    -4.2860    0.05902 -4.4500  -4.12200
## g_ilr     -0.1229    0.05121 -0.2651   0.01925
## 
## Parameter correlation:
##          parent_0  log_k1   log_k2   g_ilr
## parent_0  1.00000  0.1640  0.01315  0.4253
## log_k1    0.16400  1.0000  0.46478 -0.5526
## log_k2    0.01315  0.4648  1.00000 -0.6631
## g_ilr     0.42526 -0.5526 -0.66310  1.0000
## 
## Residual standard error: 1.439 on 4 degrees of freedom
## 
## Backtransformed parameters:
## Confidence intervals for internally transformed parameters are asymmetric.
## t-test (unrealistically) based on the assumption of normal distribution
## for estimators of untransformed parameters.
##          Estimate t value    Pr(&gt;t)    Lower     Upper
## parent_0 97.75000  67.970 1.404e-07 93.75000 101.70000
## k1        0.51620   7.499 8.460e-04  0.35650   0.74750
## k2        0.01376  16.940 3.557e-05  0.01168   0.01621
## g         0.45660  25.410 7.121e-06  0.40730   0.50680
## 
## Chi2 error levels in percent:
##          err.min n.optim df
## All data   2.225       4  4
## parent     2.225       4  4
## 
## Estimated disappearance times:
##         DT50 DT90 DT50_k1 DT50_k2
## parent 7.464  123   1.343   50.37
## 
## Data:
##  time variable observed predicted residual
##     0   parent     97.8     97.75  0.05396
##     3   parent     60.0     60.45 -0.44933
##     7   parent     51.0     49.44  1.56338
##    14   parent     43.0     43.84 -0.83632
##    30   parent     35.0     35.15 -0.14707
##    60   parent     22.0     23.26 -1.25919
##    91   parent     15.0     15.18 -0.18181
##   120   parent     12.0     10.19  1.81395</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(mm.L3[[<span class="st">"DFOP"</span>, <span class="dv">1</span>]], <span class="dt">show_errmin =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="FOCUS_L_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<p>Here, a look to the model plot, the confidence intervals of the parameters and the correlation matrix suggest that the parameter estimates are reliable, and the DFOP model can be used as the best-fit model based on the <span class="math inline">\(\chi^2\)</span> error level criterion for laboratory data L3.</p>
<p>This is also an example where the standard t-test for the parameter <code>g_ilr</code> is misleading, as it tests for a significant difference from zero. In this case, zero appears to be the correct value for this parameter, and the confidence interval for the backtransformed parameter <code>g</code> is quite narrow.</p>
</div>
</div>
<div id="laboratory-data-l4" class="section level1">
<h1 class="hasAnchor">
<a href="#laboratory-data-l4" class="anchor"></a>Laboratory Data L4</h1>
<p>The following code defines example dataset L4 from the FOCUS kinetics report, p. 293:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FOCUS_<span class="dv">2006</span>_L4 =<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">t =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">14</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">91</span>, <span class="dv">120</span>),
  <span class="dt">parent =</span> <span class="kw">c</span>(<span class="fl">96.6</span>, <span class="fl">96.3</span>, <span class="fl">94.3</span>, <span class="fl">88.8</span>, <span class="fl">74.9</span>, <span class="fl">59.9</span>, <span class="fl">53.5</span>, <span class="fl">49.0</span>))
FOCUS_<span class="dv">2006</span>_L4_mkin &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mkin_wide_to_long.html">mkin_wide_to_long</a></span>(FOCUS_<span class="dv">2006</span>_L4)</code></pre></div>
<p>Fits of the SFO and FOMC models, plots and summaries are produced below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Only use one core here, not to offend the CRAN checks</span>
mm.L4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mmkin.html">mmkin</a></span>(<span class="kw">c</span>(<span class="st">"SFO"</span>, <span class="st">"FOMC"</span>), <span class="dt">cores =</span> <span class="dv">1</span>,
               <span class="kw">list</span>(<span class="st">"FOCUS L4"</span> =<span class="st"> </span>FOCUS_<span class="dv">2006</span>_L4_mkin),
               <span class="dt">quiet =</span> <span class="ot">TRUE</span>)
<span class="kw">plot</span>(mm.L4)</code></pre></div>
<p><img src="FOCUS_L_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<p>The <span class="math inline">\(\chi^2\)</span> error level of 3.3% as well as the plot suggest that the SFO model fits very well. The error level at which the <span class="math inline">\(\chi^2\)</span> test passes is slightly lower for the FOMC model. However, the difference appears negligible.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(mm.L4[[<span class="st">"SFO"</span>, <span class="dv">1</span>]], <span class="dt">data =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## mkin version:    0.9.46.3 
## R version:       3.4.3 
## Date of fit:     Thu Mar  1 14:32:03 2018 
## Date of summary: Thu Mar  1 14:32:03 2018 
## 
## Equations:
## d_parent/dt = - k_parent_sink * parent
## 
## Model predictions using solution type analytical 
## 
## Fitted with method Port using 46 model solutions performed in 0.089 s
## 
## Weighting: none
## 
## Starting values for parameters to be optimised:
##               value   type
## parent_0       96.6  state
## k_parent_sink   0.1 deparm
## 
## Starting values for the transformed parameters actually optimised:
##                       value lower upper
## parent_0          96.600000  -Inf   Inf
## log_k_parent_sink -2.302585  -Inf   Inf
## 
## Fixed parameter values:
## None
## 
## Optimised, transformed parameters with symmetric confidence intervals:
##                   Estimate Std. Error  Lower   Upper
## parent_0             96.44    1.94900 91.670 101.200
## log_k_parent_sink    -5.03    0.07999 -5.225  -4.834
## 
## Parameter correlation:
##                   parent_0 log_k_parent_sink
## parent_0            1.0000            0.5865
## log_k_parent_sink   0.5865            1.0000
## 
## Residual standard error: 3.651 on 6 degrees of freedom
## 
## Backtransformed parameters:
## Confidence intervals for internally transformed parameters are asymmetric.
## t-test (unrealistically) based on the assumption of normal distribution
## for estimators of untransformed parameters.
##                Estimate t value    Pr(&gt;t)     Lower     Upper
## parent_0      96.440000   49.49 2.283e-09 91.670000 1.012e+02
## k_parent_sink  0.006541   12.50 8.008e-06  0.005378 7.955e-03
## 
## Chi2 error levels in percent:
##          err.min n.optim df
## All data   3.287       2  6
## parent     3.287       2  6
## 
## Resulting formation fractions:
##             ff
## parent_sink  1
## 
## Estimated disappearance times:
##        DT50 DT90
## parent  106  352</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(mm.L4[[<span class="st">"FOMC"</span>, <span class="dv">1</span>]], <span class="dt">data =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## mkin version:    0.9.46.3 
## R version:       3.4.3 
## Date of fit:     Thu Mar  1 14:32:03 2018 
## Date of summary: Thu Mar  1 14:32:03 2018 
## 
## Equations:
## d_parent/dt = - (alpha/beta) * 1/((time/beta) + 1) * parent
## 
## Model predictions using solution type analytical 
## 
## Fitted with method Port using 66 model solutions performed in 0.134 s
## 
## Weighting: none
## 
## Starting values for parameters to be optimised:
##          value   type
## parent_0  96.6  state
## alpha      1.0 deparm
## beta      10.0 deparm
## 
## Starting values for the transformed parameters actually optimised:
##               value lower upper
## parent_0  96.600000  -Inf   Inf
## log_alpha  0.000000  -Inf   Inf
## log_beta   2.302585  -Inf   Inf
## 
## Fixed parameter values:
## None
## 
## Optimised, transformed parameters with symmetric confidence intervals:
##           Estimate Std. Error  Lower    Upper
## parent_0   99.1400     1.6800 94.820 103.5000
## log_alpha  -0.3506     0.3725 -1.308   0.6068
## log_beta    4.1740     0.5635  2.726   5.6230
## 
## Parameter correlation:
##           parent_0 log_alpha log_beta
## parent_0    1.0000   -0.5365  -0.6083
## log_alpha  -0.5365    1.0000   0.9913
## log_beta   -0.6083    0.9913   1.0000
## 
## Residual standard error: 2.315 on 5 degrees of freedom
## 
## Backtransformed parameters:
## Confidence intervals for internally transformed parameters are asymmetric.
## t-test (unrealistically) based on the assumption of normal distribution
## for estimators of untransformed parameters.
##          Estimate t value    Pr(&gt;t)   Lower   Upper
## parent_0  99.1400  59.020 1.322e-08 94.8200 103.500
## alpha      0.7042   2.685 2.178e-02  0.2703   1.835
## beta      64.9800   1.775 6.807e-02 15.2600 276.600
## 
## Chi2 error levels in percent:
##          err.min n.optim df
## All data   2.029       3  5
## parent     2.029       3  5
## 
## Estimated disappearance times:
##         DT50 DT90 DT50back
## parent 108.9 1644    494.9</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-ranke2014">
<p>Ranke, Johannes. 2014. “Prüfung und Validierung von Modellierungssoftware als Alternative zu ModelMaker 4.0.” Umweltbundesamt Projektnummer 27452.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#laboratory-data-l1">Laboratory Data L1</a></li>
      <li>
<a href="#laboratory-data-l2">Laboratory Data L2</a><ul class="nav nav-pills nav-stacked">
<li><a href="#sfo-fit-for-l2">SFO fit for L2</a></li>
      <li><a href="#fomc-fit-for-l2">FOMC fit for L2</a></li>
      <li><a href="#dfop-fit-for-l2">DFOP fit for L2</a></li>
      </ul>
</li>
      <li>
<a href="#laboratory-data-l3">Laboratory Data L3</a><ul class="nav nav-pills nav-stacked">
<li><a href="#fit-multiple-models">Fit multiple models</a></li>
      <li><a href="#accessing-mmkin-objects">Accessing mmkin objects</a></li>
      </ul>
</li>
      <li><a href="#laboratory-data-l4">Laboratory Data L4</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Johannes Ranke.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
