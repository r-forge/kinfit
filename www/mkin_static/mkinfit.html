<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<title>mkinfit. mkin 0.9-11</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="
  Johannes Ranke &lt;jranke@uni-bremen.de&gt;
">

<link href="css/bootstrap.css" rel="stylesheet">
<link href="css/bootstrap-responsive.css" rel="stylesheet">
<link href="css/highlight.css" rel="stylesheet">
<link href="css/staticdocs.css" rel="stylesheet">

<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
  </head>

  <body>
    <div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="#">mkin 0.9-11</a>
      <div class="nav">
        <ul class="nav">
          <li><a href="index.html"><i class="icon-home icon-white"></i> Index</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>

    <div class="container">
      <header>
        
      </header>
      
      <h1>
  Fit a kinetic model to data with one or more state variables.
</h1>

<div class="row">
  <div class="span8">
    <h2>Usage</h2>
    <pre>mkinfit(mkinmod, observed, parms.ini = "auto", state.ini = c(100, rep(0, length(mkinmod$diffs) - 
  1)), fixed_parms = NULL, fixed_initials = names(mkinmod$diffs)[-1], solution_type = "auto", 
      plot = FALSE, quiet = FALSE, err = NULL, weight = "none", scaleVar = FALSE, atol = 1e-08, 
      rtol = 1e-10, n.outtimes = 100, trace_parms, ...)</pre>
    
    <h2>Arguments</h2>
    <dl>
      <dt>mkinmod</dt>
      <dd>
    A list of class <code><a href='mkinmod.html'>mkinmod</a></code>, containing the kinetic model to be fitted to the data.
  </dd>
      <dt>observed</dt>
      <dd>
    The observed data. It has to be in the long format as described in
    <code><a href='http://www.inside-r.org/r-doc/FME/modFit'>modFit</a></code>, i.e. the first column called "name" must contain the name of the
    observed variable for each data point. The second column must contain the
    times of observation, named "time".  The third column must be named "value"
    and contain the observed values. Optionally, a further column can contain
    weights for each data point. If it is not named "err", its name must be
    passed as a further argument named <code>err</code> which is then passed on to
    <code><a href='http://www.inside-r.org/r-doc/FME/modFit'>modFit</a></code>.
  </dd>
      <dt>parms.ini</dt>
      <dd>
    A named vector of initial values for the parameters, including parameters to
    be optimised and potentially also fixed parameters as indicated by <code>fixed_parms</code>.
    If set to "auto", initial values for rate constants are set to default values.
  </dd>
      <dt>state.ini</dt>
      <dd>
    A named vector of initial values for the state variables of the model. In case the 
    observed variables are represented by more than one model variable, the names will
    differ from the names of the observed variables (see <code>map</code> component of 
    <code><a href='mkinmod.html'>mkinmod</a></code>). The default is to set the initial value of the first model
    variable to 100 and all others to 0.
  </dd>
      <dt>fixed_parms</dt>
      <dd>
    The names of parameters that should not be optimised but rather kept at the values
    specified in <code>parms.ini</code>.
  </dd>
      <dt>fixed_initials</dt>
      <dd>
    The names of model variables for which the initial state at time 0 should be excluded
    from the optimisation. Defaults to all state variables except for the first one.
  </dd>
      <dt>solution_type</dt>
      <dd>
    If set to "eigen", the solution of the system of differential equations is based on the 
    spectral decomposition of the coefficient matrix in cases that this is
    possible. If set to "deSolve", a numerical ode solver from package
    <code><a href='http://www.inside-r.org/r-doc/deSolve/deSolve'>deSolve</a></code> is used. If set to "analytical", an analytical solution
    of the model is used. This is only implemented for simple degradation experiments
    with only one state variable, i.e. with no metabolites. The default is "auto", 
    which uses "analytical" if possible, otherwise "eigen" if the model can be expressed
    using eigenvalues and eigenvectors, and finally "deSolve" for the remaining
    models (time dependence of degradation rates and metabolites).
  </dd>
      <dt>plot</dt>
      <dd>
    Should the observed values and the numerical solutions be plotted at each stage
    of the optimisation?
  </dd>
      <dt>quiet</dt>
      <dd>
    Suppress printing out the current model cost after each improvement?
  </dd>
      <dt>err </dt>
      <dd>either <code>NULL</code>, or the name of the column with the
    <em>error</em> estimates, used to weigh the residuals (see details of
    <code><a href='http://www.inside-r.org/r-doc/FME/modCost'>modCost</a></code>); if <code>NULL</code>, then the residuals are not weighed.
  </dd>
      <dt>weight</dt>
      <dd>only if <code>err</code>=<code>NULL</code>: how to weigh the
    residuals, one of "none", "std", "mean", see details of <code><a href='http://www.inside-r.org/r-doc/FME/modCost'>modCost</a></code>.
  </dd>
      <dt>scaleVar</dt>
      <dd>
    Will be passed to <code><a href='http://www.inside-r.org/r-doc/FME/modCost'>modCost</a></code>. Default is not to scale Variables according
    to the number of observations.
  </dd>
      <dt>atol</dt>
      <dd>
    Absolute error tolerance, passed to <code><a href='http://www.inside-r.org/r-doc/deSolve/ode'>ode</a></code>. Default is 1e-8,
    lower than in <code><a href='http://www.inside-r.org/r-doc/deSolve/lsoda'>lsoda</a></code>.
  </dd>
      <dt>rtol</dt>
      <dd>
    Absolute error tolerance, passed to <code><a href='http://www.inside-r.org/r-doc/deSolve/ode'>ode</a></code>. Default is 1e-10,
    much lower than in <code><a href='http://www.inside-r.org/r-doc/deSolve/lsoda'>lsoda</a></code>.
  </dd>
      <dt>n.outtimes</dt>
      <dd>
    The length of the dataseries that is produced by the model prediction
    function <code><a href='mkinpredict.html'>mkinpredict</a></code>. This impacts the accuracy of
    the numerical solver if that is used (see <code>solution</code> argument. 
    The default value is 100.
  </dd>
      <dt>trace_parms</dt>
      <dd>
    Should a trace of the parameter values be listed?
  </dd>
      <dt>...</dt>
      <dd>
    Further arguments that will be passed to <code><a href='http://www.inside-r.org/r-doc/FME/modFit'>modFit</a></code>. 
  </dd>
    </dl>
    
    <div class="Description">
      <h2>Description</h2>
      
      <p>This function uses the Flexible Modelling Environment package
  <code><a href='http://www.inside-r.org/r-doc/FME/FME'>FME</a></code> to create a function calculating the model cost, which is
  then minimised, using the specified initial or fixed parameters and starting
  values.</p>
  
    </div>

    <div class="Value">
      <h2>Value</h2>
      
      <p>A list with "mkinfit" and "modFit" in the class attribute. 
    A summary can be obtained by <code><a href='summary.mkinfit.html'>summary.mkinfit</a></code>.</p>
  
    </div>
    
    <h2 id="examples">Examples</h2>
    <pre class="examples"><div class='input'># One parent compound, one metabolite, both single first order.
SFO_SFO <- mkinmod(
  parent = list(type = "SFO", to = "m1", sink = TRUE),
  m1 = list(type = "SFO"))
# Fit the model to the FOCUS example dataset D using defaults
fit <- mkinfit(SFO_SFO, FOCUS_2006_D)
</div>
<div class='output'>Model cost at call  1 :  18994.29 
Model cost at call  3 :  18994.29 
Model cost at call  7 :  10642.61 
Model cost at call  8 :  10642.61 
Model cost at call  10 :  10642.61 
Model cost at call  12 :  7148.119 
Model cost at call  14 :  7148.118 
Model cost at call  17 :  412.0354 
Model cost at call  18 :  412.0353 
Model cost at call  22 :  371.2203 
Model cost at call  23 :  371.2203 
Model cost at call  25 :  371.2203 
Model cost at call  27 :  371.2134 
Model cost at call  28 :  371.2134 
Model cost at call  30 :  371.2134 
Model cost at call  32 :  371.2134 
</div>
<div class='input'>str(fit)
</div>
<div class='output'>List of 28
 $ par              : Named num [1:4] 99.6 -3.04 -2.98 -5.25
  ..- attr(*, "names")= chr [1:4] "parent_0" "k_parent_sink" "k_parent_m1" "k_m1_sink"
 $ hessian          : num [1:4, 1:4] 15.1 -280.1 131.2 -89 -280.1 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:4] "parent_0" "k_parent_sink" "k_parent_m1" "k_m1_sink"
  .. ..$ : chr [1:4] "parent_0" "k_parent_sink" "k_parent_m1" "k_m1_sink"
 $ residuals        : Named num [1:40] 0.138 -2.442 -3.262 -2.262 10.843 ...
  ..- attr(*, "names")= chr [1:40] "parent" "parent" "parent" "parent" ...
 $ info             : int 1
 $ message          : chr "Relative error in the sum of squares is at most `ftol'."
 $ iterations       : int 6
 $ rsstrace         : num [1:7] 18994 10643 7148 412 371 ...
 $ ssr              : num 371
 $ diag             : Named num [1:4] 3.06 75.96 109.31 40.9
  ..- attr(*, "names")= chr [1:4] "diag.parent_0" "diag.k_parent_sink" "diag.k_parent_m1" "diag.k_m1_sink"
 $ ms               : num 9.28
 $ var_ms           : Named num [1:2] 11.55 7.42
  ..- attr(*, "names")= chr [1:2] "parent" "m1"
 $ var_ms_unscaled  : Named num [1:2] 11.55 7.42
  ..- attr(*, "names")= chr [1:2] "parent" "m1"
 $ var_ms_unweighted: Named num [1:2] 11.55 7.42
  ..- attr(*, "names")= chr [1:2] "parent" "m1"
 $ rank             : int 4
 $ df.residual      : int 36
 $ solution_type    : chr "eigen"
 $ mkinmod          :List of 5
  ..$ diffs    : Named chr [1:2] "d_parent = - k_parent_sink * parent - k_parent_m1 * parent" "d_m1 = + k_parent_m1 * parent - k_m1_sink * m1"
  .. ..- attr(*, "names")= chr [1:2] "parent" "m1"
  ..$ parms    : chr [1:3] "k_parent_sink" "k_parent_m1" "k_m1_sink"
  ..$ map      :List of 2
  .. ..$ parent: Named chr "parent"
  .. .. ..- attr(*, "names")= chr "SFO"
  .. ..$ m1    : Named chr "m1"
  .. .. ..- attr(*, "names")= chr "SFO"
  ..$ use_of_ff: chr "min"
  ..$ coefmat  : chr [1:2, 1:2] "- k_parent_sink - k_parent_m1" "k_parent_m1" "0" "- k_m1_sink"
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "parent" "m1"
  .. .. ..$ : chr [1:2] "parent" "m1"
  ..- attr(*, "class")= chr "mkinmod"
 $ observed         :'data.frame':	44 obs. of  3 variables:
  ..$ name : Factor w/ 2 levels "m1","parent": 2 2 2 2 2 2 2 2 2 2 ...
  ..$ time : num [1:44] 0 0 1 1 3 3 7 7 14 14 ...
  ..$ value: num [1:44] 99.5 102 93.5 92.5 63.2 ...
 $ obs_vars         : chr [1:2] "parent" "m1"
 $ predicted        :'data.frame':	218 obs. of  3 variables:
  ..$ name : Factor w/ 2 levels "m1","parent": 2 2 2 2 2 2 2 2 2 2 ...
  ..$ time : num [1:218] 0 1 1.21 2.42 3 ...
  ..$ value: num [1:218] 99.6 90.2 88.4 78.4 74.1 ...
 $ start            :'data.frame':	4 obs. of  3 variables:
  ..$ initial    : num [1:4] 100 0.1 0.1 0.1
  ..$ type       : chr [1:4] "state" "deparm" "deparm" "deparm"
  ..$ transformed: num [1:4] 100 -2.3 -2.3 -2.3
 $ fixed            :'data.frame':	1 obs. of  2 variables:
  ..$ value: num 0
  ..$ type : chr "state"
 $ data             :'data.frame':	44 obs. of  5 variables:
  ..$ time     : num [1:44] 0 0 1 1 3 3 7 7 14 14 ...
  ..$ variable : Ord.factor w/ 2 levels "parent"<"m1": 1 1 1 1 1 1 1 1 1 1 ...
  ..$ observed : num [1:44] 99.5 102 93.5 92.5 63.2 ...
  ..$ predicted: num [1:44] 99.6 99.6 90.2 90.2 74.1 ...
  ..$ residual : num [1:44] -0.138 2.442 3.262 2.262 -10.843 ...
 $ atol             : num 1e-08
 $ rtol             : num 1e-10
 $ parms.all        : Named num [1:4] 99.59848 0.04792 0.05078 0.00526
  ..- attr(*, "names")= chr [1:4] "parent_0" "k_parent_sink" "k_parent_m1" "k_m1_sink"
 $ odeparms.final   : Named num [1:3] 0.04792 0.05078 0.00526
  ..- attr(*, "names")= chr [1:3] "k_parent_sink" "k_parent_m1" "k_m1_sink"
 $ date             : chr "Mon Feb 18 00:33:27 2013"
 - attr(*, "class")= chr [1:2] "mkinfit" "modFit"
</div>
<div class='input'>summary(fit)
</div>
<div class='output'>mkin version:    0.9.11 
R version:       2.15.2 
Date of fit:     Mon Feb 18 00:33:27 2013 
Date of summary: Mon Feb 18 00:33:28 2013 

Equations:
[1] d_parent = - k_parent_sink * parent - k_parent_m1 * parent
[2] d_m1 = + k_parent_m1 * parent - k_m1_sink * m1            

Starting values for optimised parameters:
              initial   type transformed
parent_0        100.0  state  100.000000
k_parent_sink     0.1 deparm   -2.302585
k_parent_m1       0.1 deparm   -2.302585
k_m1_sink         0.1 deparm   -2.302585

Fixed parameter values:
   value  type
m1     0 state

Optimised, transformed parameters:
              Estimate Std. Error
parent_0        99.598      1.614
k_parent_sink   -3.038      0.078
k_parent_m1     -2.980      0.041
k_m1_sink       -5.248      0.136

Backtransformed parameters:
              Estimate
parent_0        99.598
k_parent_sink    0.048
k_parent_m1      0.051
k_m1_sink        0.005

Residual standard error: 3.211 on 36 degrees of freedom

Chi2 error levels in percent:
         err.min n.optim df
All data   6.565       4 16
parent     6.827       3  6
m1         4.748       1 10

Estimated disappearance times:
          DT50   DT90
parent   7.023  23.33
m1     131.761 437.70

Estimated formation fractions:
                ff
parent_sink 0.4855
parent_m1   0.5145
m1_sink     1.0000

Parameter correlation:
              parent_0 k_parent_sink k_parent_m1 k_m1_sink
parent_0       1.00000       0.60752    -0.06625   -0.1701
k_parent_sink  0.60752       1.00000    -0.08741   -0.6253
k_parent_m1   -0.06625      -0.08741     1.00000    0.4716
k_m1_sink     -0.17006      -0.62527     0.47164    1.0000

Data:
 time variable observed             predicted               residual
    0   parent    99.46 99.598483102551412571  -0.138483102551418824
    0   parent   102.04 99.598483102551412571   2.441516897448593681
    1   parent    93.50 90.237871664430755914   3.262128335569244086
    1   parent    92.50 90.237871664430755914   2.262128335569244086
    3   parent    63.23 74.073195848117975970 -10.843195848117979097
    3   parent    68.99 74.073195848117975970  -5.083195848117981086
    7   parent    52.32 49.912067533842055411   2.407932466157944873
    7   parent    55.13 49.912067533842055411   5.217932466157947147
   14   parent    27.27 25.012574568407188735   2.257425431592810838
   14   parent    26.64 25.012574568407188735   1.627425431592811833
   21   parent    11.50 12.534621734832612105  -1.034621734832612105
   21   parent    11.64 12.534621734832612105  -0.894621734832611537
   35   parent     2.85  3.147870841631791983  -0.297870841631791894
   35   parent     2.91  3.147870841631791983  -0.237870841631791841
   50   parent     0.69  0.716240206166767868  -0.026240206166767921
   50   parent     0.63  0.716240206166767868  -0.086240206166767863
   75   parent     0.05  0.060738167189573450  -0.010738167189573447
   75   parent     0.06  0.060738167189573450  -0.000738167189573452
  100   parent       NA  0.005150681184587969                     NA
  100   parent       NA  0.005150681184587969                     NA
  120   parent       NA  0.000715462799982884                     NA
  120   parent       NA  0.000715462799982884                     NA
    0       m1     0.00  0.000000000000007105  -0.000000000000007105
    0       m1     0.00  0.000000000000007105  -0.000000000000007105
    1       m1     4.84  4.802957023916746948   0.037042976083252910
    1       m1     5.64  4.802957023916746948   0.837042976083252732
    3       m1    12.91 13.023998924142922817  -0.113998924142922675
    3       m1    12.96 13.023998924142922817  -0.063998924142921965
    7       m1    22.97 25.044760779275236473  -2.074760779275237610
    7       m1    24.47 25.044760779275236473  -0.574760779275237610
   14       m1    41.69 36.690024013585997409   4.999975986414000317
   14       m1    33.21 36.690024013585997409  -3.480024013585996556
   21       m1    44.37 41.653097145062609741   2.716902854937387701
   21       m1    46.44 41.653097145062609741   4.786902854937387986
   35       m1    41.22 43.313122565081414450  -2.093122565081415587
   35       m1    37.95 43.313122565081414450  -5.363122565081411608
   50       m1    41.19 41.218313780432936255  -0.028313780432938529
   50       m1    40.01 41.218313780432936255  -1.208313780432938245
   75       m1    40.09 36.447033546767862333   3.642966453232141077
   75       m1    33.85 36.447033546767862333  -2.597033546767860912
  100       m1    31.04 31.981623203150189028  -0.941623203150189880
  100       m1    33.13 31.981623203150189028   1.148376796849813530
  120       m1    25.15 28.789836487140348709  -3.639836487140350130
  120       m1    33.31 28.789836487140348709   4.520163512859653565
</div></pre>
  </div>
  <div class="span4">
    <!-- <ul>
      <li>mkinfit</li>
    </ul>
    <ul>
      <li> models </li><li> optimize </li>
    </ul> -->
      
    
    <h2>Author</h2>
    
  Johannes Ranke <jranke@uni-bremen.de>

    
  </div>
</div>
      
      <footer>
      <p class="pull-right"><a href="#">Back to top</a></p>
<p>Built by <a href="https://github.com/hadley/staticdocs">staticdocs</a>. Styled with <a href="http://twitter.github.com/bootstrap">bootstrap</a>.</p>
      </footer>
    </div>
  </body>
</html>