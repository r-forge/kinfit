<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>
  Fit a kinetic model to data with one or more state variables.
. mkin </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="
  Johannes Ranke &lt;jranke@uni-bremen.de&gt;
">

    <!-- Le styles -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <style>
      body {padding-top: 60px;}
      h2 {padding-top: 20px}
    </style>
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href="css/highlight.css" rel="stylesheet">
    <link href="css/staticdocs.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class = "container">
          <a class="brand">mkin </a>
          <div class="nav">
            <ul class="nav">
              <li><a href="index.html"><i class="icon-home icon-white"></i> Index</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">
      <h1>
  Fit a kinetic model to data with one or more state variables.
</h1>

      <div class="row">
        <div class="span8">
          <h2>Usage</h2>
          <pre><span class="functioncall"><a href='mkinfit.html'>mkinfit</a></span><span class="keyword">(</span><span class="symbol">mkinmod</span><span class="keyword">,</span> <span class="symbol">observed</span><span class="keyword">,</span> <span class="argument">parms.ini</span> <span class="argument">=</span> <span class="string">"auto"</span><span class="keyword">,</span> <span class="argument">state.ini</span> <span class="argument">=</span> <span class="functioncall"><a href='NA'>c</a></span><span class="keyword">(</span><span class="number">100</span><span class="keyword">,</span> <span class="functioncall"><a href='NA'>rep</a></span><span class="keyword">(</span><span class="number">0</span><span class="keyword">,</span> <span class="functioncall"><a href='NA'>length</a></span><span class="keyword">(</span><span class="symbol">mkinmod</span><span class="keyword">$</span><span class="symbol">diffs</span><span class="keyword">)</span> <span class="keyword">-</span>
  <span class="number">1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">fixed_parms</span> <span class="argument">=</span> NULL<span class="keyword">,</span> <span class="argument">fixed_initials</span> <span class="argument">=</span> <span class="functioncall"><a href='NA'>names</a></span><span class="keyword">(</span><span class="symbol">mkinmod</span><span class="keyword">$</span><span class="symbol">diffs</span><span class="keyword">)</span><span class="keyword">[</span><span class="keyword">-</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">,</span> <span class="argument">solution_type</span> <span class="argument">=</span> <span class="string">"auto"</span><span class="keyword">,</span>
      <span class="argument">plot</span> <span class="argument">=</span> <span class="number">FALSE</span><span class="keyword">,</span> <span class="argument">quiet</span> <span class="argument">=</span> <span class="number">FALSE</span><span class="keyword">,</span> <span class="argument">err</span> <span class="argument">=</span> NULL<span class="keyword">,</span> <span class="argument">weight</span> <span class="argument">=</span> <span class="string">"none"</span><span class="keyword">,</span> <span class="argument">scaleVar</span> <span class="argument">=</span> <span class="number">FALSE</span><span class="keyword">,</span> <span class="argument">atol</span> <span class="argument">=</span> <span class="number">1e-08</span><span class="keyword">,</span>
      <span class="argument">rtol</span> <span class="argument">=</span> <span class="number">1e-10</span><span class="keyword">,</span> <span class="argument">n.outtimes</span> <span class="argument">=</span> <span class="number">100</span><span class="keyword">,</span> <span class="symbol">trace_parms</span><span class="keyword">,</span> <span class="symbol">...</span><span class="keyword">)</span></pre>
          
          <h2>Arguments</h2>
          <dl>
            <dt>mkinmod</dt>
            <dd>
    A list of class <code><a href='mkinmod.html'>mkinmod</a></code>, containing the kinetic model to be fitted to the data.
  </dd>
            <dt>observed</dt>
            <dd>
    The observed data. It has to be in the long format as described in
    <code><a href='NA'>modFit</a></code>, i.e. the first column must contain the name of the
    observed variable for each data point. The second column must contain the
    times of observation, named "time".  The third column must be named "value"
    and contain the observed values. Optionally, a further column can contain
    weights for each data point. If it is not named "err", its name must be
    passed as a further argument named <code>err</code> which is then passed on to
    <code><a href='NA'>modFit</a></code>.
  </dd>
            <dt>parms.ini</dt>
            <dd>
    A named vector of initial values for the parameters, including parameters to
    be optimised and potentially also fixed parameters as indicated by <code>fixed_parms</code>.
    If set to "auto", initial values for rate constants are set to default values.
  </dd>
            <dt>state.ini</dt>
            <dd>
    A named vector of initial values for the state variables of the model. In case the 
    observed variables are represented by more than one model variable, the names will
    differ from the names of the observed variables (see <code>map</code> component of 
    <code><a href='mkinmod.html'>mkinmod</a></code>). The default is to set the initial value of the first model
    variable to 100 and all others to 0.
  </dd>
            <dt>fixed_parms</dt>
            <dd>
    The names of parameters that should not be optimised but rather kept at the values
    specified in <code>parms.ini</code>.
  </dd>
            <dt>fixed_initials</dt>
            <dd>
    The names of model variables for which the initial state at time 0 should be excluded
    from the optimisation. Defaults to all state variables except for the first one.
  </dd>
            <dt>solution_type</dt>
            <dd>
    If set to "eigen", the solution of the system of differential equations is based on the 
    spectral decomposition of the coefficient matrix in cases that this is
    possible. If set to "deSolve", a numerical ode solver from package
    <code><a href='NA'>deSolve</a></code> is used. If set to "analytical", an analytical solution
    of the model is used. This is only implemented for simple degradation experiments
    with only one state variable, i.e. with no metabolites. The default is "auto", 
    which uses "analytical" if possible, otherwise "eigen" if the model can be expressed
    using eigenvalues and eigenvectors, and finally "deSolve" for the remaining
    models (time dependence of degradation rates and metabolites).
  </dd>
            <dt>plot</dt>
            <dd>
    Should the observed values and the numerical solutions be plotted at each stage
    of the optimisation?
  </dd>
            <dt>quiet</dt>
            <dd>
    Suppress printing out the current model cost after each improvement?
  </dd>
            <dt>err </dt>
            <dd>either <code>NULL</code>, or the name of the column with the
    <em>error</em> estimates, used to weigh the residuals (see details of
    <code><a href='NA'>modCost</a></code>); if <code>NULL</code>, then the residuals are not weighed.
  </dd>
            <dt>weight</dt>
            <dd>only if <code>err</code>=<code>NULL</code>: how to weigh the
    residuals, one of "none", "std", "mean", see details of <code><a href='NA'>modCost</a></code>.
  </dd>
            <dt>scaleVar</dt>
            <dd>
    Will be passed to <code><a href='NA'>modCost</a></code>. Default is not to scale Variables according
    to the number of observations.
  </dd>
            <dt>atol</dt>
            <dd>
    Absolute error tolerance, passed to <code><a href='NA'>ode</a></code>. Default is 1e-8,
    lower than in <code><a href='NA'>lsoda</a></code>.
  </dd>
            <dt>rtol</dt>
            <dd>
    Absolute error tolerance, passed to <code><a href='NA'>ode</a></code>. Default is 1e-10,
    much lower than in <code><a href='NA'>lsoda</a></code>.
  </dd>
            <dt>n.outtimes</dt>
            <dd>
    The length of the dataseries that is produced by the model prediction
    function <code><a href='mkinpredict.html'>mkinpredict</a></code>. This impacts the accuracy of
    the numerical solver if that is used (see <code>solution</code> argument. 
    The default value is 100.
  </dd>
            <dt>trace_parms</dt>
            <dd>
    Should a trace of the parameter values be listed?
  </dd>
            <dt>...</dt>
            <dd>
    Further arguments that will be passed to <code><a href='NA'>modFit</a></code>. 
  </dd>
          </dl>
          
          <div class="Description">
            <h2>Description</h2>
            
            <p>This function uses the Flexible Modelling Environment package
  <code><a href='NA'>FME</a></code> to create a function calculating the model cost, which is
  then minimised, using the specified initial or fixed parameters and starting
  values.</p>
        
          </div>

          <div class="Value">
            <h2>Value</h2>
            
            <p>A list with "mkinfit" and "modFit" in the class attribute. 
    A summary can be obtained by <code><a href='summary.mkinfit.html'>summary.mkinfit</a></code>.</p>
        
          </div>
      
          <h2 id="examples">Examples</h2>
          <pre class="examples"><div class='input'><span class="comment"># One parent compound, one metabolite, both single first order.</span>
<span class="symbol">SFO_SFO</span> <span class="assignement">&lt;-</span> <span class="functioncall"><a href='mkinmod.html'>mkinmod</a></span><span class="keyword">(</span>
  <span class="argument">parent</span> <span class="argument">=</span> <span class="functioncall"><a href='NA'>list</a></span><span class="keyword">(</span><span class="argument">type</span> <span class="argument">=</span> <span class="string">"SFO"</span><span class="keyword">,</span> <span class="argument">to</span> <span class="argument">=</span> <span class="string">"m1"</span><span class="keyword">,</span> <span class="argument">sink</span> <span class="argument">=</span> <span class="number">TRUE</span><span class="keyword">)</span><span class="keyword">,</span>
  <span class="argument">m1</span> <span class="argument">=</span> <span class="functioncall"><a href='NA'>list</a></span><span class="keyword">(</span><span class="argument">type</span> <span class="argument">=</span> <span class="string">"SFO"</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment"># Fit the model to the FOCUS example dataset D using defaults</span>
<span class="symbol">fit</span> <span class="assignement">&lt;-</span> <span class="functioncall"><a href='mkinfit.html'>mkinfit</a></span><span class="keyword">(</span><span class="symbol">SFO_SFO</span><span class="keyword">,</span> <span class="symbol">FOCUS_2006_D</span><span class="keyword">)</span></div>
<div class='output'>Model cost at call  1 :  18994.29 
Model cost at call  3 :  18994.29 
Model cost at call  7 :  10642.61 
Model cost at call  8 :  10642.61 
Model cost at call  10 :  10642.61 
Model cost at call  12 :  7148.118 
Model cost at call  14 :  7148.118 
Model cost at call  17 :  412.0354 
Model cost at call  18 :  412.0353 
Model cost at call  22 :  371.2203 
Model cost at call  23 :  371.2203 
Model cost at call  25 :  371.2203 
Model cost at call  27 :  371.2134 
Model cost at call  28 :  371.2134 
Model cost at call  30 :  371.2134 
Model cost at call  32 :  371.2134 
</div>
<div class='input'><span class="functioncall"><a href='NA'>str</a></span><span class="keyword">(</span><span class="symbol">fit</span><span class="keyword">)</span></div>
<div class='output'>List of 28
 $ par              : Named num [1:4] 99.6 -3.04 -2.98 -5.25
  ..- attr(*, "names")= chr [1:4] "parent_0" "k_parent_sink" "k_parent_m1" "k_m1_sink"
 $ hessian          : num [1:4, 1:4] 15.1 -280.1 131.2 -89 -280.1 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:4] "parent_0" "k_parent_sink" "k_parent_m1" "k_m1_sink"
  .. ..$ : chr [1:4] "parent_0" "k_parent_sink" "k_parent_m1" "k_m1_sink"
 $ residuals        : Named num [1:40] 0.138 -2.442 -3.262 -2.262 10.843 ...
  ..- attr(*, "names")= chr [1:40] "parent" "parent" "parent" "parent" ...
 $ info             : int 1
 $ message          : chr "Relative error in the sum of squares is at most `ftol'."
 $ iterations       : int 6
 $ rsstrace         : num [1:7] 18994 10643 7148 412 371 ...
 $ ssr              : num 371
 $ diag             : Named num [1:4] 3.06 75.96 109.31 40.9
  ..- attr(*, "names")= chr [1:4] "diag.parent_0" "diag.k_parent_sink" "diag.k_parent_m1" "diag.k_m1_sink"
 $ ms               : num 9.28
 $ var_ms           : Named num [1:2] 11.55 7.42
  ..- attr(*, "names")= chr [1:2] "parent" "m1"
 $ var_ms_unscaled  : Named num [1:2] 11.55 7.42
  ..- attr(*, "names")= chr [1:2] "parent" "m1"
 $ var_ms_unweighted: Named num [1:2] 11.55 7.42
  ..- attr(*, "names")= chr [1:2] "parent" "m1"
 $ rank             : int 4
 $ df.residual      : int 36
 $ solution_type    : chr "eigen"
 $ mkinmod          :List of 5
  ..$ diffs    : Named chr [1:2] "d_parent = - k_parent_sink * parent - k_parent_m1 * parent" "d_m1 = + k_parent_m1 * parent - k_m1_sink * m1"
  .. ..- attr(*, "names")= chr [1:2] "parent" "m1"
  ..$ parms    : chr [1:3] "k_parent_sink" "k_parent_m1" "k_m1_sink"
  ..$ map      :List of 2
  .. ..$ parent: Named chr "parent"
  .. .. ..- attr(*, "names")= chr "SFO"
  .. ..$ m1    : Named chr "m1"
  .. .. ..- attr(*, "names")= chr "SFO"
  ..$ use_of_ff: chr "min"
  ..$ coefmat  : chr [1:2, 1:2] "- k_parent_sink - k_parent_m1" "k_parent_m1" "0" "- k_m1_sink"
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "parent" "m1"
  .. .. ..$ : chr [1:2] "parent" "m1"
  ..- attr(*, "class")= chr "mkinmod"
 $ observed         :'data.frame':	44 obs. of  3 variables:
  ..$ name : Factor w/ 2 levels "m1","parent": 2 2 2 2 2 2 2 2 2 2 ...
  ..$ time : num [1:44] 0 0 1 1 3 3 7 7 14 14 ...
  ..$ value: num [1:44] 99.5 102 93.5 92.5 63.2 ...
 $ obs_vars         : chr [1:2] "parent" "m1"
 $ predicted        :'data.frame':	218 obs. of  3 variables:
  ..$ name : Factor w/ 2 levels "m1","parent": 2 2 2 2 2 2 2 2 2 2 ...
  ..$ time : num [1:218] 0 1 1.21 2.42 3 ...
  ..$ value: num [1:218] 99.6 90.2 88.4 78.4 74.1 ...
 $ start            :'data.frame':	4 obs. of  3 variables:
  ..$ initial    : num [1:4] 100 0.1 0.1 0.1
  ..$ type       : chr [1:4] "state" "deparm" "deparm" "deparm"
  ..$ transformed: num [1:4] 100 -2.3 -2.3 -2.3
 $ fixed            :'data.frame':	1 obs. of  2 variables:
  ..$ value: num 0
  ..$ type : chr "state"
 $ data             :'data.frame':	44 obs. of  5 variables:
  ..$ time     : num [1:44] 0 0 1 1 3 3 7 7 14 14 ...
  ..$ variable : Ord.factor w/ 2 levels "parent"<"m1": 1 1 1 1 1 1 1 1 1 1 ...
  ..$ observed : num [1:44] 99.5 102 93.5 92.5 63.2 ...
  ..$ predicted: num [1:44] 99.6 99.6 90.2 90.2 74.1 ...
  ..$ residual : num [1:44] -0.138 2.442 3.262 2.262 -10.843 ...
 $ atol             : num 1e-08
 $ rtol             : num 1e-10
 $ parms.all        : Named num [1:4] 99.59848 0.04792 0.05078 0.00526
  ..- attr(*, "names")= chr [1:4] "parent_0" "k_parent_sink" "k_parent_m1" "k_m1_sink"
 $ odeparms.final   : Named num [1:3] 0.04792 0.05078 0.00526
  ..- attr(*, "names")= chr [1:3] "k_parent_sink" "k_parent_m1" "k_m1_sink"
 $ date             : chr "Tue Jul  3 23:34:48 2012"
 - attr(*, "class")= chr [1:2] "mkinfit" "modFit"
</div>
<div class='input'><span class="functioncall"><a href='NA'>summary</a></span><span class="keyword">(</span><span class="symbol">fit</span><span class="keyword">)</span></div>
<div class='output'>mkin version:    0.9.4 
R version:       2.15.1 
Date of fit:     Tue Jul  3 23:34:48 2012 
Date of summary: Tue Jul  3 23:34:48 2012 

Equations:
[1] d_parent = - k_parent_sink * parent - k_parent_m1 * parent
[2] d_m1 = + k_parent_m1 * parent - k_m1_sink * m1            

Starting values for optimised parameters:
              initial   type transformed
parent_0        100.0  state  100.000000
k_parent_sink     0.1 deparm   -2.302585
k_parent_m1       0.1 deparm   -2.302585
k_m1_sink         0.1 deparm   -2.302585

Fixed parameter values:
   value  type
m1     0 state

Optimised, transformed parameters:
              Estimate Std. Error
parent_0        99.598      1.614
k_parent_sink   -3.038      0.078
k_parent_m1     -2.980      0.041
k_m1_sink       -5.248      0.136

Backtransformed parameters:
              Estimate
parent_0        99.598
k_parent_sink    0.048
k_parent_m1      0.051
k_m1_sink        0.005

Residual standard error: 3.211 on 36 degrees of freedom

Chi2 error levels in percent:
         err.min n.optim df
All data   6.565       4 16
parent     6.827       3  6
m1         4.748       1 10

Estimated disappearance times:
          DT50   DT90
parent   7.023  23.33
m1     131.761 437.70

Estimated formation fractions:
                ff
parent_sink 0.4855
parent_m1   0.5145
m1_sink     1.0000

Parameter correlation:
              parent_0 k_parent_sink k_parent_m1 k_m1_sink
parent_0       1.00000       0.60752    -0.06625   -0.1701
k_parent_sink  0.60752       1.00000    -0.08741   -0.6253
k_parent_m1   -0.06625      -0.08741     1.00000    0.4716
k_m1_sink     -0.17006      -0.62527     0.47164    1.0000

Data:
 time variable observed  predicted    residual
    0   parent    99.46 99.5984830  -0.1384830
    0   parent   102.04 99.5984830   2.4415170
    1   parent    93.50 90.2378716   3.2621284
    1   parent    92.50 90.2378716   2.2621284
    3   parent    63.23 74.0731958 -10.8431958
    3   parent    68.99 74.0731958  -5.0831958
    7   parent    52.32 49.9120675   2.4079325
    7   parent    55.13 49.9120675   5.2179325
   14   parent    27.27 25.0125746   2.2574254
   14   parent    26.64 25.0125746   1.6274254
   21   parent    11.50 12.5346218  -1.0346218
   21   parent    11.64 12.5346218  -0.8946218
   35   parent     2.85  3.1478709  -0.2978709
   35   parent     2.91  3.1478709  -0.2378709
   50   parent     0.69  0.7162402  -0.0262402
   50   parent     0.63  0.7162402  -0.0862402
   75   parent     0.05  0.0607382  -0.0107382
   75   parent     0.06  0.0607382  -0.0007382
  100   parent       NA  0.0051507          NA
  100   parent       NA  0.0051507          NA
  120   parent       NA  0.0007155          NA
  120   parent       NA  0.0007155          NA
    0       m1     0.00  0.0000000   0.0000000
    0       m1     0.00  0.0000000   0.0000000
    1       m1     4.84  4.8029570   0.0370430
    1       m1     5.64  4.8029570   0.8370430
    3       m1    12.91 13.0239989  -0.1139989
    3       m1    12.96 13.0239989  -0.0639989
    7       m1    22.97 25.0447608  -2.0747608
    7       m1    24.47 25.0447608  -0.5747608
   14       m1    41.69 36.6900240   4.9999760
   14       m1    33.21 36.6900240  -3.4800240
   21       m1    44.37 41.6530971   2.7169029
   21       m1    46.44 41.6530971   4.7869029
   35       m1    41.22 43.3131226  -2.0931226
   35       m1    37.95 43.3131226  -5.3631226
   50       m1    41.19 41.2183138  -0.0283138
   50       m1    40.01 41.2183138  -1.2083138
   75       m1    40.09 36.4470336   3.6429664
   75       m1    33.85 36.4470336  -2.5970336
  100       m1    31.04 31.9816232  -0.9416232
  100       m1    33.13 31.9816232   1.1483768
  120       m1    25.15 28.7898365  -3.6398365
  120       m1    33.31 28.7898365   4.5201635
</div></pre>
        </div>
        <div class="span4">
          <!-- <ul>
            <li>mkinfit</li>
          </ul>
          <ul>
            <li> models </li><li> optimize </li>
          </ul> -->
            
          
          <h2>Author</h2>
          
  Johannes Ranke <jranke@uni-bremen.de>

          
        </div>
      </div>
      <footer class="footer">
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p>Built by <a href="https://github.com/hadley/staticdocs">staticdocs</a>. Styled with <a href="http://twitter.github.com/bootstrap">bootstrap</a>.</p>
      </footer>
    </div> <!-- /container -->
  </body>
</html>